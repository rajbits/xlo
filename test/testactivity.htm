<!DOCTYPE html>
<html>
	<head>
		<title>Activities test</title>
		<link rel="stylesheet" href="../src/assets/lib/bootstrap/css/bootstrap.min.css" />
		<style>
			*, button
			{
				outline: none;
			}
			.act-row
			{
				padding: 5px;
				border-bottom: 1px lightgrey solid;
			}		
			.act-row .act-play-btn
			{
				position: relative;
				top: -4px;
			}	
			.act-row .glyphicon
			{
				font-size: 80%;
			}		
			.container
			{
				padding: 10px;
			}
			
			.act-status
			{
				font-size: 80%;
				color: gray;
			}
			
			[contenteditable=true]:empty:before 
			{
				content: attr(placeholder);
				color: lightgrey;
				font-size: 80%;
			}
		</style>
	</head>
	<body>
		<div id='container' class='container'>
			<h4>Activities</h4>
		</div>
		
		<script src='../src/assets/lib/jquery/jquery-2.0.3.min.js'></script>
		<script src="../src/assets/lib/watch/watch.js"></script>
		<script src='../src/assets/js/duplex-0.8.js'></script>
		<script src="timer.js"></script>
		
		<script id='activities' type='text/html'>
			<div class='row act-row' dp-repeat='a in list'>				
				<div class='col-md-6 col-sm-6 col-xs-8'>
					<div>
						<div dp-bind='a.name' contenteditable='true' placeholder='Activity name' dp-ui-event='keyup: tap'></div>
						<div class='act-status' dp-bind='a.status' contenteditable='true' placeholder='Status/Notes'></div>
					</div>
				</div>
				<div class='col-md-1 col-sm-1 col-xs-1'>
					<div class='btn btn-sm act-play-btn' dp-ui-event='click: timer' dp-data='o: a' dp-plugin='playToggle'>
						<span class='glyphicon glyphicon-play'></span>
					</div>
					<div dp-bind='a.total | formatTotal'></div>
				</div>
				<div class='col-md-1 col-sm-1 col-xs-1' dp-bind='a.priority' contenteditable='true' placeholder='Priority'></div>
				<div class='col-md-1 col-sm-1 col-xs-1' dp-bind='a.seconds' contenteditable='true' placeholder='Estimate'></div>				
			</div>			
		</script>
		<script>
			$.fn.playToggle = function()
			{
				return this.each(function()
				{
					var $me = $(this), play = 'glyphicon-play', pause = 'glyphicon-pause', $s = $me.find('>span');
					$me.click(function(e)
					{
						if ($s.hasClass(play))
							$s.removeClass(play).addClass(pause);
						else
							$s.removeClass(pause).addClass(play);
					});					
				});				
			};
		</script>
		<script>
			var list = 
			[{
				name: 'First activity',
				priority: 1,
				seconds: 500,
				status: 'Work in progress, but waiting on response from seller'
			},
			{
				name: 'Second activity',
				seconds: 500,
				total: 400
			},
			{
				name: 'Third activity',
				priority: 1,
				seconds: 500
			}
			];			
			var o =
			{
				template: $('#activities').html(),
				model:
				{
					list: list,
					formatTotal: function(v)
					{
						if (v == undefined) v = 0;
						var timer = new Timer(v);				
						return timer.format();
					},
					
					timer: function(e)
					{
						var $me = $(this), a = $me.data('o');
						if (a == null)
							return;
						
						var timer = $me.data('timer');
						var callbacks = 
						{
							tick: function(total_time)
							{
								a.total = total_time;
							}
						};
						
						if (timer == null)
						{
							timer = new Timer(a.total, callbacks);
							$me.data('timer', timer);
						}
						
						timer.toggle();			
					},
					
					tap: function(e)
					{
						
					}
				},
				default_parent: $('#container')
			};
			
			var $el = duplex.bind(o);
			console.log($el.html());
			$('#container').append($el);
		</script>
	</body>
</html>